version: '3'
services:
    scribble-client:
        build: ./client
        container_name: scribble-client
        restart: on-failure
        volumes:
            - scribble-client-static:/app
        environment:
            - NODE_ENV=production

    scribble-server:
        build: ./server
        container_name: scribble-server
        restart: always
        volumes:
            - ./server:/app

    scribble-router:
        image: nginx:latest
        container_name: scribble-router
        restart: always
        volumes:
            - ./nginx/prod.conf:/etc/nginx/conf.d/default.conf
            - scribble-client-static:/var/www/scribble:ro
        ports:
            - "${PORT:-80}:80"
            - "${HTTPS_PORT:-443}:443"
        command: "nginx -g 'daemon off;'"

    scribble-database:
        image: mysql:latest
        container_name: scribble-database
        restart: always
        command: --default-authentication-plugin=mysql_native_password
        restart: always
        ports:
            - "3306:3306"
        volumes:
            - mysql-datavolume:/var/lib/msql
        environment:
            MYSQL_DATABASE: "db"
            MYSQL_USER: "user"
            MYSQL_ROOT_PASSWORD: "password"
            MYSQL_ROOT_PASSWORD: "password"

volumes:
    mysql-datavolume:
    scribble-client-static:
